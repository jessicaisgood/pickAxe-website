{"ast":null,"code":"var _jsxFileName = \"/Users/wangxi05104/Desktop/website/src/views/modal/CreditCardForm.js\";\nimport React from 'react';\nimport { CardElement, injectStripe } from 'react-stripe-elements';\nimport styles from '../../styles/modal/credit-card-modal.module.scss';\nimport { Result, Button, message } from 'antd';\nimport WebServerRestClient from \"../../tools/WebServerRestClient\";\nimport UserComponent from \"../../components/UserComponent\";\nimport PropTypes from \"prop-types\";\nconst style = {\n  base: {\n    iconColor: '#c4f0ff',\n    color: '#fff',\n    fontWeight: 500,\n    fontFamily: 'Roboto, Open Sans, Segoe UI, sans-serif',\n    fontSize: '14px',\n    fontSmoothing: 'antialiased',\n    ':-webkit-autofill': {\n      color: '#fce883'\n    },\n    '::placeholder': {\n      color: '#87BBFD'\n    }\n  },\n  invalid: {\n    iconColor: '#FFC7EE',\n    color: '#FFC7EE'\n  }\n}; // You can customize your Elements to give it the look and feel of your site.\n\nconst createOptions = () => {\n  return {\n    style: {\n      base: {\n        fontSize: '16px',\n        color: '#424770',\n        fontFamily: 'Open Sans, sans-serif',\n        letterSpacing: '0.025em',\n        '::placeholder': {\n          color: '#aab7c4'\n        }\n      },\n      invalid: {\n        color: '#c23d4b'\n      }\n    }\n  };\n};\n\nclass _CardForm extends UserComponent {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      errorMessage: '',\n      paymentStatus: 'init'\n    };\n\n    this.handleChange = ({\n      error\n    }) => {\n      if (error) {\n        this.setState({\n          errorMessage: error.message\n        });\n      }\n    };\n\n    this.handleSubmit = evt => {\n      let thisPage = this;\n      this.setState({\n        processing: true\n      });\n      evt.preventDefault();\n\n      if (this.props.stripe) {\n        this.props.stripe.createToken().then(function (result) {\n          if (result.token) {\n            // alert(JSON.stringify(result));\n            thisPage.creditCardPayment(result.token.id);\n          } else {\n            // alert(JSON.stringify(result.error));\n            thisPage.setState({\n              processing: false\n            });\n          }\n        });\n      } else {\n        console.log(\"Stripe.js hasn't loaded yet.\");\n        thisPage.setState({\n          processing: false\n        });\n      }\n    };\n  }\n\n  creditCardPayment(token) {\n    let thisPage = this;\n    new WebServerRestClient().POST('/user/payment/create-credit-order', {\n      purchasePlanId: this.props.productDetail.id,\n      paymentWay: 5,\n      userId: window.CurrentUser.userId,\n      sourceId: token\n    }).then(response => {\n      if (response.code == 200) {\n        thisPage.setState({\n          paymentStatus: 'success'\n        });\n      } else if (response.code == 401 || response.code == 403) {\n        message.warn(\"请登录！\");\n      } else {\n        message.warn(response['msg']);\n        thisPage.setState({\n          paymentStatus: 'error'\n        });\n      }\n    }).catch(err => {\n      message.error(err.message);\n    });\n  }\n\n  render() {\n    if (this.state.paymentStatus === 'init') {\n      return React.createElement(\"form\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }, React.createElement(CardElement, Object.assign({\n        className: styles.MyCardElement,\n        style: style,\n        onChange: this.handleChange.bind(this)\n      }, createOptions(), {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: styles.err_message,\n        role: \"alert\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118\n        },\n        __self: this\n      }, this.state.errorMessage), React.createElement(Button, {\n        onClick: this.handleSubmit.bind(this),\n        loading: this.state.processing,\n        className: styles.payment_button,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121\n        },\n        __self: this\n      }, \"Pay $\", this.props.productDetail.amount));\n    } else if (this.state.paymentStatus === 'success') {\n      return React.createElement(Result, {\n        status: \"success\",\n        title: \"Purchased Successfully!\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127\n        },\n        __self: this\n      });\n    } else if (this.state.paymentStatus === 'error') {\n      return React.createElement(Result, {\n        status: \"error\",\n        title: \"Internal Server Error!\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134\n        },\n        __self: this\n      });\n    }\n  }\n\n}\n\n_CardForm.propTypes = {\n  productDetail: PropTypes.object\n};\nexport default injectStripe(_CardForm);","map":{"version":3,"sources":["/Users/wangxi05104/Desktop/website/src/views/modal/CreditCardForm.js"],"names":["React","CardElement","injectStripe","styles","Result","Button","message","WebServerRestClient","UserComponent","PropTypes","style","base","iconColor","color","fontWeight","fontFamily","fontSize","fontSmoothing","invalid","createOptions","letterSpacing","_CardForm","state","errorMessage","paymentStatus","handleChange","error","setState","handleSubmit","evt","thisPage","processing","preventDefault","props","stripe","createToken","then","result","token","creditCardPayment","id","console","log","POST","purchasePlanId","productDetail","paymentWay","userId","window","CurrentUser","sourceId","response","code","warn","catch","err","render","MyCardElement","bind","err_message","payment_button","amount","propTypes","object"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {CardElement, injectStripe} from 'react-stripe-elements';\nimport styles from '../../styles/modal/credit-card-modal.module.scss';\nimport { Result, Button,message } from 'antd';\nimport WebServerRestClient from \"../../tools/WebServerRestClient\";\nimport UserComponent from \"../../components/UserComponent\";\nimport PropTypes from \"prop-types\";\n\nconst style = {\n    base: {\n        iconColor: '#c4f0ff',\n        color: '#fff',\n        fontWeight: 500,\n        fontFamily: 'Roboto, Open Sans, Segoe UI, sans-serif',\n        fontSize: '14px',\n        fontSmoothing: 'antialiased',\n\n        ':-webkit-autofill': {\n            color: '#fce883',\n        },\n        '::placeholder': {\n            color: '#87BBFD',\n        },\n    },\n    invalid: {\n        iconColor: '#FFC7EE',\n        color: '#FFC7EE',\n    },\n};\n\n// You can customize your Elements to give it the look and feel of your site.\nconst createOptions = () => {\n    return {\n        style: {\n            base: {\n                fontSize: '16px',\n                color: '#424770',\n                fontFamily: 'Open Sans, sans-serif',\n                letterSpacing: '0.025em',\n                '::placeholder': {\n                    color: '#aab7c4',\n                },\n            },\n            invalid: {\n                color: '#c23d4b',\n            },\n        }\n    }\n};\n\n\nclass _CardForm extends UserComponent {\n\n    static propTypes = {\n        productDetail: PropTypes.object\n    };\n\n    state = {\n        errorMessage: '',\n        paymentStatus: 'init'\n    };\n\n    handleChange = ({error}) => {\n        if (error) {\n            this.setState({errorMessage: error.message});\n        }\n    };\n\n    handleSubmit = (evt) => {\n        let thisPage = this;\n        this.setState({processing: true});\n        evt.preventDefault();\n        if (this.props.stripe) {\n            this.props.stripe.createToken().then(function (result) {\n                if (result.token) {\n                    // alert(JSON.stringify(result));\n                    thisPage.creditCardPayment(result.token.id);\n                } else {\n                    // alert(JSON.stringify(result.error));\n                    thisPage.setState({processing: false});\n                }\n            });\n        } else {\n            console.log(\"Stripe.js hasn't loaded yet.\");\n            thisPage.setState({processing: false});\n        }\n    };\n\n    creditCardPayment(token) {\n        let thisPage = this;\n        new WebServerRestClient().POST('/user/payment/create-credit-order',{\n            purchasePlanId: this.props.productDetail.id,\n            paymentWay: 5,\n            userId: window.CurrentUser.userId,\n            sourceId: token\n        }).then(response => {\n            if (response.code == 200) {\n                thisPage.setState({paymentStatus: 'success'});\n            } else if (response.code == 401 || response.code == 403) {\n                message.warn(\"请登录！\")\n            } else {\n                message.warn(response['msg']);\n                thisPage.setState({paymentStatus: 'error'});\n            }\n        }).catch(err => {\n            message.error(err.message);\n        });\n    }\n\n    render() {\n        if (this.state.paymentStatus === 'init') {\n            return (\n                <form>\n                    <CardElement className={styles.MyCardElement} style={style}\n                                 onChange={this.handleChange.bind(this)}\n                                 {...createOptions()}\n                    />\n                    <div className={styles.err_message} role=\"alert\">\n                        {this.state.errorMessage}\n                    </div>\n                    <Button onClick={this.handleSubmit.bind(this)} loading={this.state.processing}\n                            className={styles.payment_button}>Pay ${this.props.productDetail.amount}</Button>\n                </form>\n            );\n        } else if (this.state.paymentStatus === 'success') {\n            return (\n                <Result\n                    status=\"success\"\n                    title=\"Purchased Successfully!\"\n                />\n            );\n        } else if (this.state.paymentStatus === 'error') {\n            return (\n                <Result\n                    status=\"error\"\n                    title=\"Internal Server Error!\"\n                />\n            )\n        }\n    }\n}\n\nexport default injectStripe(_CardForm);\n"]},"metadata":{},"sourceType":"module"}